services:
  dev:
    build:
      context: .
      dockerfile: docker/Dockerfile
    volumes:
      # Proof of concept: mount ONLY this repo into /workspace
      - .:/workspace

      # Gradle cache
      - gradle-cache:/home/gradle/.gradle

      # Mount Hytale install read-only (so Gradle can compile against the server jar)
      - "/Users/chrisjennison/Library/Application Support/Hytale/install:/hytale/install:ro"

      # Mount Mods folder writable (so `installToHytaleMods` can copy the jar)
      - "/Users/chrisjennison/Library/Application Support/Hytale/UserData/Mods:/hytale/UserData/Mods"
    working_dir: /workspace
    tty: true

    # Force Gradle project properties in Docker (overrides repo gradle.properties)
    environment:
    
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ORG_GRADLE_PROJECT_hytale_home: /hytale
      ORG_GRADLE_PROJECT_patchline: release
      ORG_GRADLE_PROJECT_require_hytale: "true"
      ORG_GRADLE_PROJECT_includes_pack: "false"
      ORG_GRADLE_PROJECT_load_user_mods: "false"
      ORG_GRADLE_PROJECT_java_version: "25"

volumes:
  gradle-cache:
