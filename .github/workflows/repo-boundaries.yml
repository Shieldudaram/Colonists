name: Repo Boundaries

on:
  pull_request:
    branches:
      - main
      - dev
  push:
    branches:
      - main
      - dev

permissions:
  contents: read

jobs:
  devkit-boundary:
    name: devkit-boundary
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure devkit ownership stays external
        run: |
          set -euo pipefail
          matches="$(git ls-files | grep -E '^devkit/' || true)"

          if [ -n "$matches" ]; then
            echo "ERROR: devkit paths must not be tracked in Shieldudaram/Colonists."
            echo "$matches"
            echo "Remediation: git rm -r --cached devkit"
            echo "Then ensure .gitignore includes: devkit/"
            exit 1
          fi

          echo "OK: no devkit ownership violations found."

  scripts-boundary:
    name: scripts-boundary
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure shared scripts are not tracked here
        run: |
          set -euo pipefail
          pattern='(^|/)(build-all-mods\.sh|build-all-mods 2\.sh|verify-hytale-mod-install\.sh|verify-hytale-mod-install 2\.sh|verify-module-boundaries\.sh)$'
          matches="$(git ls-files | grep -E "$pattern" || true)"

          if [ -n "$matches" ]; then
            echo "ERROR: shared scripts must live only in Shieldudaram/scripts."
            echo "$matches"
            exit 1
          fi

          echo "OK: no shared script ownership violations found."
