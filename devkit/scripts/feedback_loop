#!/usr/bin/env bash
set -euo pipefail

# feedback_loop
# --------------
#
# A convenience wrapper to run the feedback loop provided by
# ``devkit/tools/feedback_loop.py``. This script ensures that the
# Python entrypoint is invoked relative to the repository root. It
# accepts the same arguments as the underlying Python module.
#
# Usage:
#   ./scripts/feedback_loop "<initial prompt>" [--model MODEL] [--iterations N] [other args...]
#

# Determine the location of this script and the project root. This allows
# the script to be invoked from anywhere within the repository.
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
PROJECT_ROOT="${SCRIPT_DIR}/.."

PYTHON_BIN="python3"

if [[ $# -lt 1 ]]; then
  echo "Usage: $0 <prompt> [--model MODEL] [--iterations N] [--temperature T] [--max-tokens M] [--api-key KEY]" >&2
  exit 1
fi

# Invoke the Python module with the provided arguments. Note that we change
# directory to the project root so that relative imports resolve correctly.
cd "${PROJECT_ROOT}"
exec ${PYTHON_BIN} -m devkit.tools.feedback_loop "$@"